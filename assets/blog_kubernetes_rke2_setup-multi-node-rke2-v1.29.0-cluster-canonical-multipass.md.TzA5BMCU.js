import{_ as s,o as i,c as a,R as n}from"./chunks/framework.E9w9IFh5.js";const c=JSON.parse('{"title":"Multi Node RKE2 v1.29.0 with Canonical Multipass","description":"Setup a Multi Node RKE2 v1.29.0 cluster with Canonical Multipass","frontmatter":{"title":"Multi Node RKE2 v1.29.0 with Canonical Multipass","description":"Setup a Multi Node RKE2 v1.29.0 cluster with Canonical Multipass","outline":"deep"},"headers":[],"relativePath":"blog/kubernetes/rke2/setup-multi-node-rke2-v1.29.0-cluster-canonical-multipass.md","filePath":"blog/kubernetes/rke2/setup-multi-node-rke2-v1.29.0-cluster-canonical-multipass.md"}'),t={name:"blog/kubernetes/rke2/setup-multi-node-rke2-v1.29.0-cluster-canonical-multipass.md"},e=n(`<h1 id="setup-a-multi-node-rke2-v1-29-0-cluster-with-canonical-multipass" tabindex="-1">Setup a Multi Node RKE2 v1.29.0 cluster with Canonical Multipass <a class="header-anchor" href="#setup-a-multi-node-rke2-v1-29-0-cluster-with-canonical-multipass" aria-label="Permalink to &quot;Setup a Multi Node RKE2 v1.29.0 cluster with Canonical Multipass&quot;">​</a></h1><h2 id="what-is-a-multi-node-cluster" tabindex="-1">What is a Multi Node Cluster <a class="header-anchor" href="#what-is-a-multi-node-cluster" aria-label="Permalink to &quot;What is a Multi Node Cluster&quot;">​</a></h2><p>A multi-node cluster refers to a computing cluster that consists of multiple interconnected nodes or servers that work together to achieve a common computing goal. In the context of technologies like Kubernetes, a multi-node cluster typically refers to a cluster of machines that collectively form a distributed computing environment for running containerized applications.</p><h3 id="key-concepts" tabindex="-1">Key concepts <a class="header-anchor" href="#key-concepts" aria-label="Permalink to &quot;Key concepts&quot;">​</a></h3><ol><li><p>Node: In a cluster, a node is an individual computing unit, which could be a physical server or a virtual machine. Each node contributes resources such as CPU, memory, storage, and network connectivity to the overall cluster.</p></li><li><p>Cluster: A cluster is a group of interconnected nodes that work together as a single system. In the context of Kubernetes, a cluster is used to deploy, manage, and scale containerized applications.</p></li><li><p>Multi-Node Cluster: A multi-node cluster, in the context of Kubernetes or other container orchestration systems, means that the cluster spans across multiple nodes. This allows for the distribution of workloads and provides high availability and scalability. In a multi-node cluster, nodes collaborate to deploy and manage containers, ensuring that applications can run on multiple machines and handle increased workloads.</p></li><li><p>High Availability: One of the advantages of a multi-node cluster is the ability to achieve high availability. If one node fails, the workloads can be distributed across the remaining nodes, ensuring that applications continue to run without disruption.</p></li><li><p>Scalability: Multi-node clusters can be easily scaled by adding more nodes to the cluster. This allows organizations to adapt to changing resource requirements and accommodate the growth of their applications.</p></li></ol><p>In summary, a multi-node cluster in the context of Kubernetes or similar container orchestration platforms refers to a distributed system where multiple nodes work together to provide a resilient, scalable, and highly available environment for running containerized applications.</p><h2 id="pre-requisite" tabindex="-1">Pre-requisite <a class="header-anchor" href="#pre-requisite" aria-label="Permalink to &quot;Pre-requisite&quot;">​</a></h2><h3 id="install-multipass" tabindex="-1">Install Multipass <a class="header-anchor" href="#install-multipass" aria-label="Permalink to &quot;Install Multipass&quot;">​</a></h3><p>Follow installation instructions to install Multipass, if you haven&#39;t yet: <a href="https://multipass.run/install" target="_blank" rel="noreferrer">https://multipass.run/install</a></p><h3 id="launch-multipass-vm-instances" tabindex="-1">Launch Multipass VM instances <a class="header-anchor" href="#launch-multipass-vm-instances" aria-label="Permalink to &quot;Launch Multipass VM instances&quot;">​</a></h3><p>Ubuntu 23.04 VM Machines</p><h3 id="launch-controller-instances" tabindex="-1">Launch Controller instances <a class="header-anchor" href="#launch-controller-instances" aria-label="Permalink to &quot;Launch Controller instances&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> launch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --disk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">G</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> launch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --disk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">G</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> launch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --disk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">G</span></span></code></pre></div><h3 id="launch-worker-instances" tabindex="-1">Launch Worker instances <a class="header-anchor" href="#launch-worker-instances" aria-label="Permalink to &quot;Launch Worker instances&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> launch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --disk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">G</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> launch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --disk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">G</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> launch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">GB</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --disk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">G</span></span></code></pre></div><h3 id="verify-multipass-instances" tabindex="-1">Verify Multipass instances <a class="header-anchor" href="#verify-multipass-instances" aria-label="Permalink to &quot;Verify Multipass instances&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span></code></pre></div><p><em>Output:</em></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    State</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             IPv4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             Image</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.205.2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-controller-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.205.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-controller-3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.205.4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-worker-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.205.5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-worker-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.205.6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-worker-3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">           Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.205.7</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Ubuntu</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23.04</span></span></code></pre></div><h2 id="install-first-rke2-controller" tabindex="-1">Install first rke2 controller <a class="header-anchor" href="#install-first-rke2-controller" aria-label="Permalink to &quot;Install first rke2 controller&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span></code></pre></div><h3 id="download-installation-script" tabindex="-1">Download Installation script <a class="header-anchor" href="#download-installation-script" aria-label="Permalink to &quot;Download Installation script&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.rke2.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-install.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-install.sh</span></span></code></pre></div><h3 id="configure-network-service" tabindex="-1">Configure network service <a class="header-anchor" href="#configure-network-service" aria-label="Permalink to &quot;Configure network service&quot;">​</a></h3><p><em>Enable the recommended IPv4 and/or IPv6 forwarding settings in the sysctl configuration files. Create a file named 90-rke2.conf in the /etc/sysctl.d/ directory</em></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysctl.d/90-rke2.conf</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net.ipv4.conf.all.forwarding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net.ipv6.conf.all.forwarding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1</span></span></code></pre></div><h3 id="install-rke2-server" tabindex="-1">Install RKE2 server <a class="header-anchor" href="#install-rke2-server" aria-label="Permalink to &quot;Install RKE2 server&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_TYPE=server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_CHANNEL=latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_VERSION=v1.29.0+rke2r1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./rke2-install.sh</span></span></code></pre></div><p><em>All-in-one command</em></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.rke2.io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_TYPE=server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_CHANNEL=latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_VERSION=v1.29.0+rke2r1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span></code></pre></div><h3 id="configure-the-rke2-server-service" tabindex="-1">Configure the rke2-server service <a class="header-anchor" href="#configure-the-rke2-server-service" aria-label="Permalink to &quot;Configure the rke2-server service&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rancher/rke2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rancher/rke2/config.yaml</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write-kubeconfig-mode:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0644&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tls-san:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.74</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.10.200</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disable:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node-taint:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CriticalAddonsOnly=true:NoExecute&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cni:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> calico</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disable-cloud-controller:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span></code></pre></div><h3 id="start-the-service" tabindex="-1">Start the service <a class="header-anchor" href="#start-the-service" aria-label="Permalink to &quot;Start the service&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-server</span></span></code></pre></div><h3 id="confirm-status-of-the-service-after-starting-it" tabindex="-1">Confirm status of the service after starting it <a class="header-anchor" href="#confirm-status-of-the-service-after-starting-it" aria-label="Permalink to &quot;Confirm status of the service after starting it&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-server</span></span></code></pre></div><p>Output:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">●</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-server.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Rancher</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kubernetes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Engine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (server)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> loaded</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (/usr/local/lib/systemd/system/rke2-server.service; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preset:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Active:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (running) since Sat 2023-12-23 14:53:15 CET; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">10s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ago</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       Docs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/rancher/rke2#readme</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   Main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2637</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (rke2)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      Tasks:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 78</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Memory:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 859.9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">M</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        CPU:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">min</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 49.718</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     CGroup:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /system.slice/rke2-server.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2637</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/usr/local/bin/rke2 server&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2652</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/agent/etc/containerd/config.toml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/containerd/containerd.sock</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/containerd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/li</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2662</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubelet</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --volume-plugin-dir=/var/lib/kubelet/volumeplugins</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --file-check-frequency=5s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sync-frequency=30s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --address=0.0.0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --anonymous-auth=false</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --au</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2707</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aede11a9b6ce6dad3ec51d13aef7d26d74a527f306dc1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2793</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ac6e3e2b532779a8175f19dc34352a561b4c5c086f6a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">1&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2881</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">a48d6d9d6efaf446e450a5cde2fe3b58bd710bf2d3fb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">0&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             └─2882</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d3aed5efe9e33a5f40cccf36b614641813652ec3c188</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:53:17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2637</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T14:53:17+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;Cluster dns configmap has been set successfully&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:53:17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2637</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T14:53:17+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;error syncing &#39;kube-system/rke2-calico&#39;: handler helm-controller-chart-regi&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 14:53:18 rke2-controller-1 rke2[2637]: time=&quot;2023-12-23T14:53:18+01:00&quot; level=info msg=&quot;Reconciling</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> snapshot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ConfigMap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> data&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 14:53:19 rke2-controller-1 rke2[2637]: time=&quot;2023-12-23T14:53:19+01:00&quot; level=error msg=&quot;error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> syncing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;kube-system/rke2-metrics-server&#39;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> handler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> helm-controller-c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:53:19</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2637</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T14:53:19+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;error syncing &#39;kube-system/rke2-calico-crd&#39;: handler helm-controller-chart-&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 14:53:19 rke2-controller-1 rke2[2637]: time=&quot;2023-12-23T14:53:19+01:00&quot; level=error msg=&quot;error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> syncing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;kube-system/rke2-coredns&#39;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> handler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> helm-controller-chart-re</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">g</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:53:19</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2637</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T14:53:19+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;error syncing &#39;kube-system/rke2-snapshot-controller-crd&#39;: handler helm-cont&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 14:53:20 rke2-controller-1 rke2[2637]: time=&quot;2023-12-23T14:53:20+01:00&quot; level=info msg=&quot;Running</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-proxy</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cluster-cidr=10.42.0.0/16</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --conntrack-max-per-core=0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:53:21</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2637</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T14:53:21+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;error syncing &#39;kube-system/rke2-snapshot-controller&#39;: handler helm-controll&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 14:53:21 rke2-controller-1 rke2[2637]: time=&quot;2023-12-23T14:53:21+01:00&quot; level=error msg=&quot;error</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> syncing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;kube-system/rke2-snapshot-validation-webhook&#39;:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> handler</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> helm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><h3 id="update-path-with-rke2-binaries" tabindex="-1">Update path with rke2 binaries <a class="header-anchor" href="#update-path-with-rke2-binaries" aria-label="Permalink to &quot;Update path with rke2 binaries&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;export KUBECONFIG=/etc/rancher/rke2/rke2.yaml&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;export PATH=\${PATH}:/var/lib/rancher/rke2/bin&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;alias k=kubectl&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="check-controller-node" tabindex="-1">Check controller node <a class="header-anchor" href="#check-controller-node" aria-label="Permalink to &quot;Check controller node&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Wait for node to be ready</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wait</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --for=condition=Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --timeout=600s</span></span></code></pre></div><h3 id="obtain-token" tabindex="-1">Obtain token <a class="header-anchor" href="#obtain-token" aria-label="Permalink to &quot;Obtain token&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/server/node-token</span></span></code></pre></div><p>Output</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">K100f5da8c469a178e8dc6c666ea0adf4c53beb16044ab38bad7f567dd807865be8::server:f11cfbbe06e12b28c57f3db2351046c2</span></span></code></pre></div><h3 id="leave-controller-machine" tabindex="-1">Leave controller machine <a class="header-anchor" href="#leave-controller-machine" aria-label="Permalink to &quot;Leave controller machine&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exit</span></span></code></pre></div><h2 id="set-up-additional-controller-nodes" tabindex="-1">Set up additional controller nodes <a class="header-anchor" href="#set-up-additional-controller-nodes" aria-label="Permalink to &quot;Set up additional controller nodes&quot;">​</a></h2><p>Repeat the following steps for <code>rke2-controller-2</code> and <code>rke2-controller-3</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-2</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span></code></pre></div><h3 id="download-installation-script-1" tabindex="-1">Download Installation script <a class="header-anchor" href="#download-installation-script-1" aria-label="Permalink to &quot;Download Installation script&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.rke2.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-install.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-install.sh</span></span></code></pre></div><h3 id="configure-network-service-1" tabindex="-1">Configure network service <a class="header-anchor" href="#configure-network-service-1" aria-label="Permalink to &quot;Configure network service&quot;">​</a></h3><p><em>Enable the recommended IPv4 and/or IPv6 forwarding settings in the sysctl configuration files. Create a file named 90-rke2.conf in the /etc/sysctl.d/ directory</em></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysctl.d/90-rke2.conf</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net.ipv4.conf.all.forwarding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net.ipv6.conf.all.forwarding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1</span></span></code></pre></div><h3 id="install-rke2-server-1" tabindex="-1">Install RKE2 server <a class="header-anchor" href="#install-rke2-server-1" aria-label="Permalink to &quot;Install RKE2 server&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_TYPE=server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_CHANNEL=latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_VERSION=v1.29.0+rke2r1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./rke2-install.sh</span></span></code></pre></div><p><em>All-in-one command</em></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.rke2.io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_TYPE=server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_CHANNEL=latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_VERSION=v1.29.0+rke2r1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span></code></pre></div><h3 id="configure-the-rke2-server-service-1" tabindex="-1">Configure the rke2-server service <a class="header-anchor" href="#configure-the-rke2-server-service-1" aria-label="Permalink to &quot;Configure the rke2-server service&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rancher/rke2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rancher/rke2/config.yaml</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://192.168.205.2:9345</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">token:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> K100f5da8c469a178e8dc6c666ea0adf4c53beb16044ab38bad7f567dd807865be8::server:f11cfbbe06e12b28c57f3db2351046c2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write-kubeconfig-mode:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0644&quot;</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tls-san:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.205.3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disable:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node-taint:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CriticalAddonsOnly=true:NoExecute&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cni:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> calico</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disable-cloud-controller:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span></code></pre></div><h3 id="start-the-service-1" tabindex="-1">Start the service <a class="header-anchor" href="#start-the-service-1" aria-label="Permalink to &quot;Start the service&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-server</span></span></code></pre></div><h3 id="confirm-status-of-the-service-after-starting-it-1" tabindex="-1">Confirm status of the service after starting it <a class="header-anchor" href="#confirm-status-of-the-service-after-starting-it-1" aria-label="Permalink to &quot;Confirm status of the service after starting it&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-server</span></span></code></pre></div><p>Output:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">●</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-server.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Rancher</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kubernetes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Engine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (server)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> loaded</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (/usr/local/lib/systemd/system/rke2-server.service; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preset:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Active:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (running) since Sat 2023-12-23 15:37:33 CET; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">11s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ago</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       Docs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/rancher/rke2#readme</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   Main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5391</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (rke2)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      Tasks:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 90</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Memory:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">G</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        CPU:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">min</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10.283</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     CGroup:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /system.slice/rke2-server.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─5391</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/usr/local/bin/rke2 server&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─5401</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/agent/etc/containerd/config.toml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/containerd/containerd.sock</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/containerd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/agent/containerd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─5593</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubelet</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --volume-plugin-dir=/var/lib/kubelet/volumeplugins</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --file-check-frequency=5s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sync-frequency=30s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --address=0.0.0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --anonymous-auth=false</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --authentication-token-webhook=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --authoriza</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─5630</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 48</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d9abb84978b07850a245847ed48bc3a885bc7bd7adff325a13ac8ed8cae1d2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/conta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─5716</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">c1aa4021549a851aef44ee57bee97d28dc2f6f3e6d9a96ed943838d462957fa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/conta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─5810</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1986793</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cd1840d812a807329e84fb4036cfb0c6802d1fc7ae6840e2c14280269</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/conta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─5811</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 66</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">effca73a55fc2f05f81d250f13cb9a176030ea059ab43723a214b4f8079b8f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/conta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             └─5983</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a9ee3d3d0008f502ceb450f357fe5a678fc633935c73cb17258f727b13de87c3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/conta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:37:35</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5391</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T15:37:35+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;Running kube-proxy --cluster-cidr=10.42.0.0/16 --conntrack-max-per-core=0 --conntrack-tcp-timeout-close-wait=0s --connt&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 15:37:35 rke2-controller-2 rke2[5391]: time=&quot;2023-12-23T15:37:35+01:00&quot; level=info msg=&quot;certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CN=rke2,O=rke2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> signed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CN=rke2-server-ca@1703340760:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> notBefore=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2023</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">-12-23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:12:40</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +0000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> UTC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> notAfter=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">2&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:37:35</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5391</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T15:37:35+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;Updating TLS secret for kube-system/rke2-serving (count: 15): map[listener.cattle.io/cn-10.43.0.1:10.43.0.1 listener.ca&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 15:37:35 rke2-controller-2 rke2[5391]: time=&quot;2023-12-23T15:37:35+01:00&quot; level=info msg=&quot;Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /v1,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kind=Secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> controller&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 15:37:35 rke2-controller-2 rke2[5391]: time=&quot;2023-12-23T15:37:35+01:00&quot; level=info msg=&quot;Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /v1,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kind=Node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> controller&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 15:37:35 rke2-controller-2 rke2[5391]: time=&quot;2023-12-23T15:37:35+01:00&quot; level=info msg=&quot;Cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dns</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configmap</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> already</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exists&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 15:37:35 rke2-controller-2 rke2[5391]: time=&quot;2023-12-23T15:37:35+01:00&quot; level=info msg=&quot;Reconciliation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ETCDSnapshotFile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> resources</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> complete&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 15:37:35 rke2-controller-2 rke2[5391]: time=&quot;2023-12-23T15:37:35+01:00&quot; level=info msg=&quot;Updating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TLS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-system/rke2-serving</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (count: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">): map[listener.cattle.io/cn-10.43.0.1:10.43.0.1 listener.ca</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Dec </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:37:35 rke2-controller-2 rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5391</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]: time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2023-12-23T15:37:35+01:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> level</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">info msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Labels and annotations have been set successfully on node: rke2-controller-2&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Dec </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 15</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:37:35 rke2-controller-2 rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5391</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]: time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2023-12-23T15:37:35+01:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> level</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">info msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Active TLS secret kube-system/rke2-serving (ver=4556) (count 15): map[listener.cattle.io/cn-10.43.0.1:10.43.0.1 listene&gt;</span></span></code></pre></div><h3 id="update-path-with-rke2-binaries-1" tabindex="-1">Update path with rke2 binaries <a class="header-anchor" href="#update-path-with-rke2-binaries-1" aria-label="Permalink to &quot;Update path with rke2 binaries&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;export KUBECONFIG=/etc/rancher/rke2/rke2.yaml&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;export PATH=\${PATH}:/var/lib/rancher/rke2/bin&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;alias k=kubectl&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="check-controller-node-1" tabindex="-1">Check controller node <a class="header-anchor" href="#check-controller-node-1" aria-label="Permalink to &quot;Check controller node&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Wait for node to be ready</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wait</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --for=condition=Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --timeout=600s</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span></span></code></pre></div><p>Output:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    control-plane,etcd,master</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   23</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.29.0+rke2r1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-controller-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    control-plane,etcd,master</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   69</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.29.0+rke2r1</span></span></code></pre></div><h3 id="leave-controller-machine-1" tabindex="-1">Leave controller machine <a class="header-anchor" href="#leave-controller-machine-1" aria-label="Permalink to &quot;Leave controller machine&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exit</span></span></code></pre></div><h2 id="join-worker-nodes" tabindex="-1">Join worker nodes <a class="header-anchor" href="#join-worker-nodes" aria-label="Permalink to &quot;Join worker nodes&quot;">​</a></h2><p>Repeat the following steps for <code>rke2-worker-1</code>, <code>rke2-worker-2</code>, and <code>rke2-worker-3</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span></code></pre></div><h3 id="download-installation-script-2" tabindex="-1">Download Installation script <a class="header-anchor" href="#download-installation-script-2" aria-label="Permalink to &quot;Download Installation script&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.rke2.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-install.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-install.sh</span></span></code></pre></div><h3 id="configure-network-service-2" tabindex="-1">Configure network service <a class="header-anchor" href="#configure-network-service-2" aria-label="Permalink to &quot;Configure network service&quot;">​</a></h3><p><em>Enable the recommended IPv4 and/or IPv6 forwarding settings in the sysctl configuration files. Create a file named 90-rke2.conf in the /etc/sysctl.d/ directory</em></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/sysctl.d/90-rke2.conf</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net.ipv4.conf.all.forwarding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">net.ipv6.conf.all.forwarding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=1</span></span></code></pre></div><h3 id="install-rke2-agent" tabindex="-1">Install RKE2 agent <a class="header-anchor" href="#install-rke2-agent" aria-label="Permalink to &quot;Install RKE2 agent&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_TYPE=agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_CHANNEL=latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_VERSION=v1.29.0+rke2r1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./rke2-install.sh</span></span></code></pre></div><p><em>All-in-one command</em></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.rke2.io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_TYPE=agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_CHANNEL=latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> INSTALL_RKE2_VERSION=v1.29.0+rke2r1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span></code></pre></div><h3 id="configure-the-rke2-agent-service" tabindex="-1">Configure the rke2-agent service <a class="header-anchor" href="#configure-the-rke2-agent-service" aria-label="Permalink to &quot;Configure the rke2-agent service&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rancher/rke2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/rancher/rke2/config.yaml</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">server:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://192.168.205.2:9345</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">token:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> K100f5da8c469a178e8dc6c666ea0adf4c53beb16044ab38bad7f567dd807865be8::server:f11cfbbe06e12b28c57f3db2351046c2</span></span></code></pre></div><h3 id="start-the-service-2" tabindex="-1">Start the service <a class="header-anchor" href="#start-the-service-2" aria-label="Permalink to &quot;Start the service&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-agent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-agent</span></span></code></pre></div><h3 id="confirm-status-of-the-service-after-starting-it-2" tabindex="-1">Confirm status of the service after starting it <a class="header-anchor" href="#confirm-status-of-the-service-after-starting-it-2" aria-label="Permalink to &quot;Confirm status of the service after starting it&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-agent</span></span></code></pre></div><p>Output:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">●</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-agent.service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Rancher</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Kubernetes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Engine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (agent)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> loaded</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (/usr/local/lib/systemd/system/rke2-agent.service; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">preset:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Active:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (running) since Sat 2023-12-23 17:25:50 CET; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1min</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ago</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">       Docs:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/rancher/rke2#readme</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   Main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> PID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2519</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (rke2)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      Tasks:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 58</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Memory:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 449.3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">M</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        CPU:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">min</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 36.528</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     CGroup:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /system.slice/rke2-agent.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2519</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/usr/local/bin/rke2 agent&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2535</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/agent/etc/containerd/config.toml</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/containerd/containerd.sock</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --state</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/containerd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --root</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/agent/containerd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2544</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubelet</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --volume-plugin-dir=/var/lib/kubelet/volumeplugins</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --file-check-frequency=5s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sync-frequency=30s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --address=0.0.0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --allowed-unsafe-sysctls=net.ipv4.ip_forward,net.ipv6.conf.all.forward</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             ├─2612</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> c48a67dad1378a7bbdb664d073dac9254924c4098d1968197abcca6d9a6ff736</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/conta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">             └─2673</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/rancher/rke2/data/v1.29.0-rke2r1-491b1a599021/bin/containerd-shim-runc-v2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k8s.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 713</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">f5dfff501e61459967eb969da466ea7a60b2049bf3478df65606334440f60</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /run/k3s/conta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:25:48</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2519</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T17:25:48+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;Running kubelet --address=0.0.0.0 --allowed-unsafe-sysctls=net.ipv4.ip_forward,net.ipv6.conf.all.forwarding --alsologtostde&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 17:25:48 rke2-worker-1 rke2[2519]: time=&quot;2023-12-23T17:25:48+01:00&quot; level=info msg=&quot;Connecting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy&quot; url=&quot;wss://192.168.205.3:9345/v1-rke2/connect&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 17:25:48 rke2-worker-1 rke2[2519]: time=&quot;2023-12-23T17:25:48+01:00&quot; level=info msg=&quot;Connecting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> proxy&quot; url=&quot;wss://192.168.205.2:9345/v1-rke2/connect&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 17:25:49 rke2-worker-1 rke2[2519]: time=&quot;2023-12-23T17:25:49+01:00&quot; level=info msg=&quot;Running</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kube-proxy</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cluster-cidr=10.42.0.0/16</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --conntrack-max-per-core=0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --conntrack-tcp-timeout-close-wait=0s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --conntrack</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:25:50</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2519</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T17:25:50+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;Failed to set annotations and labels on node rke2-worker-1: Operation cannot be fulfilled on nodes </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rke2-worker-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: the o&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 17:25:50 rke2-worker-1 rke2[2519]: time=&quot;2023-12-23T17:25:50+01:00&quot; level=info msg=&quot;Failed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotations</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> labels</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Operation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cannot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> be</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fulfilled</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rke2-worker-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> o</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Dec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 23</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 17</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:25:50</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2519</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=&quot;2023-12-23T17:25:50+01:00&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level=info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> msg=&quot;Failed to set annotations and labels on node rke2-worker-1: Operation cannot be fulfilled on nodes </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">rke2-worker-1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: the o&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 17:25:50 rke2-worker-1 rke2[2519]: time=&quot;2023-12-23T17:25:50+01:00&quot; level=info msg=&quot;Annotations</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> labels</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> have</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> been</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> node:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 17:25:50 rke2-worker-1 rke2[2519]: time=&quot;2023-12-23T17:25:50+01:00&quot; level=info msg=&quot;rke2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> running&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Dec 23 17:25:50 rke2-worker-1 systemd[1]: Started rke2-agent.service - Rancher Kubernetes Engine v2 (agent).</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exit</span></span></code></pre></div><h3 id="check-cluster-nodes" tabindex="-1">Check cluster nodes <a class="header-anchor" href="#check-cluster-nodes" aria-label="Permalink to &quot;Check cluster nodes&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Wait for node to be ready</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wait</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --for=condition=Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nodes</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --all</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --timeout=600s</span></span></code></pre></div><p>Output</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                       AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    control-plane,etcd,master</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   159</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    v1.29.0+rke2r1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-controller-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    control-plane,etcd,master</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   137</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    v1.29.0+rke2r1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-controller-3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    control-plane,etcd,master</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">m50s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   v1.29.0+rke2r1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-worker-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      28</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     v1.29.0+rke2r1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-worker-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      19</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     v1.29.0+rke2r1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rke2-worker-3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       Ready</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                      12</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">     v1.29.0+rke2r1</span></span></code></pre></div><h2 id="cleanup" tabindex="-1">Cleanup <a class="header-anchor" href="#cleanup" aria-label="Permalink to &quot;Cleanup&quot;">​</a></h2><p>Stop Multipass machines</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-3</span></span></code></pre></div><p>Delete Multipass machines</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multipass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-controller-3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rke2-worker-3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --purge</span></span></code></pre></div>`,117),h=[e];function l(k,p,r,F,d,o){return i(),a("div",null,h)}const C=s(t,[["render",l]]);export{c as __pageData,C as default};
